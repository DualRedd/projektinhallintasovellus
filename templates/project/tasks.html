{% extends "layout.html" %}
{% block content %}

<div class="header-flex">
    <h1>My Tasks</h1>
    <a href="/group/{{g.group_id}}/project/{{g.project_id}}/tasks/new">
        <button class="button-grey">Create New Task</button>
    </a>
</div>
<hr style="margin-top:0;">

<div class="tasks-container">
    <div class="task-item table-title">
        <div></div>
        <div>Title</div>
        <div>Priority</div>
        <div>Deadline</div>
        <div>Status</div>
        <div>Assigned Members</div>
    </div>
    {% for task in g.all_tasks %}
    {% if task["members"]|user_in_task(g.username) %}
    <div class="task-item">
        <div class="task-summary">
            <button>></button>
            <div>{{task["title"]}}</div>
            <div>{{task["priority"]}}</div>
            <div>{{task["deadline"]}}</div>
            <div>{{task["state"]}}</div>
            {% if task["members"] %}
            <div>{% for user in task["members"] %}{{user["username"]}}{% if not loop.last %}, {% endif %}{% endfor %}</div>
            {% else %}<div>None</div>{% endif %}
        </div>
        <div class="task-details">
            <button>v</button>
            <div>{{task["title"]}}</div>
            <div>{{task["priority"]}}</div>
            <div>{{task["deadline"]}}</div>
            <div>{{task["state"]}}</div>
            {% if task["members"] %}
            <div>{% for user in task["members"] %}{{user["username"]}}{% if not loop.last %}, {% endif %}{% endfor %}</div>
            {% else %}<div>None</div>{% endif %}
            <div style="grid-column: 2 / 6;">{{task["description"]}}</div>
        </div>
    </div>
    {% endif %}
    {% endfor %}
</div>

<h1>All Tasks</h1>
<hr>
<div class="tasks-container">
    <div class="task-item table-title">
        <div></div>
        <div>Title</div>
        <div>Priority</div>
        <div>Deadline</div>
        <div>Status</div>
        <div>Assigned Members</div>
    </div>
    {% for task in g.all_tasks %}
    <div class="task-item">
        <div class="task-summary">
            <button>></button>
            <div>{{task["title"]}}</div>
            <div>{{task["priority"]}}</div>
            <div>{{task["deadline"]}}</div>
            <div>{{task["state"]}}</div>
            {% if task["members"] %}
            <div>{% for user in task["members"] %}{{user["username"]}}{% if not loop.last %}, {% endif %}{% endfor %}</div>
            {% else %}<div>None</div>{% endif %}
        </div>
        <div class="task-details">
            <button>v</button>
            <div>{{task["title"]}}</div>
            <div>{{task["priority"]}}</div>
            <div>{{task["deadline"]}}</div>
            <div>{{task["state"]}}</div>
            {% if task["members"] %}
            <div>{% for user in task["members"] %}{{user["username"]}}{% if not loop.last %}, {% endif %}{% endfor %}</div>
            {% else %}<div>None</div>{% endif %}
            <div style="grid-column: 2 / 6;">{{task["description"]}}</div>
        </div>
    </div>
    {% endfor %}
</div>

{% endblock %}
{% block scripts %}
<script>
document.querySelectorAll('.task-summary button').forEach(button => {
  button.addEventListener('click', function () {
    const summary = this.parentElement;
    const details = summary.nextElementSibling;
    summary.style.display = 'none';
    details.style.display = 'contents';
  });
});
document.querySelectorAll('.task-details button').forEach(button => {
  button.addEventListener('click', function () {
    const details = this.parentElement;
    const summary = details.previousElementSibling;
    summary.style.display = 'contents';
    details.style.display = 'none';
  });
});
</script>
{% endblock %}